---
title: nfc调研
abbrlink: '3e861463'
date: 2021-02-26 10:22:52
updated:
tags:
categories:
---

最近接了点东西，要用到 nfc 标签，简单做了下调研。

这篇内容十分的水，大部分内容都是粘贴来的，因为来源太多，记不住哪里粘贴的，没法标注来源

## 基础知识调研


### NFC, RFID

RFID技术：
1.通常应用在生产，物流，跟踪和资产管理上；
2.根据频率划分包含低频、高频（13.56MHz）、超高频、微波等；
3.作用距离取决于频率、读写器功率、读写器天线增益值、标签天线尺寸等，工作距离在几厘米到几十米不等；
4.读写器和非接触卡可以是一对多关系，也可以说一对一关系；且读写器和非接触卡是两个实体，不能切换；

NFC技术：
1.通常应用在门禁，公交卡，手机支付等领域；
2.频率也是13.56MHz，且兼容大部分RFID高频相关标准（有些是不兼容）；
3.NFC作用距离较短，一般都是0~10厘米；
4.读写器和标签几乎都是一对一关系；且支持读写模式和卡模式，可以作为读写器也可变为非接触卡；

总体来说，NFC是RFID的子集，但NFC有些新特性又是RFID所不具备的。

### IC, ID, RFID

> ID卡：全称身份识别卡(Identification Card)，多为低频(125Khz)，是一种不可写入的感应卡，含固定的编号，主要有台湾SYRIS的EM格式，美国HID、TI、MOTOROLA等各类ID卡。
  IC卡：全称集成电路卡(Integrated Circuit Card)，又称智能卡(Smart Card)。多为高频(13.56Mhz)，可读写数据、容量大、有加密功能、数据记录可靠、使用更方便，如一卡通系统、消费系统等，目前主要有PHILIPS的Mifare系列卡。

  ID卡，低频(125Khz)，不可写入数据，其记录内容(卡号)只可由芯片生产厂一次性写入，开发商只可读出卡号加以利用，无法根据系统的实际需要制订新的号码管理制度；
  IC卡，高频(13.56Mhz)，不仅可由授权用户读出大量数据，而且亦可由授权用户写入大量数据(如新的卡用户的权限、用户资料等)，IC卡所记录内容可反复擦写；


### [IC卡类型] M1、UID、CUID、FUID、UFUID

IC卡中最常见的是NXP Mifare系列卡，工作在高频（13.56Mhz），根据卡内使用芯片的不同，有如下分类：

M1卡
全称Mifare S50，是最常见的卡，出厂固化UID（UID即指卡号，全球唯一），可存储修改数据；常用于学生卡，饭卡，公交卡，门禁卡；

M0卡
全称Mifare UltraLight，相当于M1卡的精简版，容量更小、功能更少，但价格更低，出厂固化UID，可存储修改数据；常用于地铁卡，公交卡；

以上两种固化了UID，为正规卡，接下来就是一些没有固化UID，即不正规的卡：

UID卡
全称Mifare UID Chinese magic card，国外叫做中国魔术卡，M1卡的变异版本，使用后门指令(magic指令)，可修改UID（UID在block0分区），可以用来完整克隆M1卡的数据；
但是现在新的读卡系统通过检测卡片对后门指令的回应，可以检测出UID卡，因此可以来拒绝UID卡的访问，来达到屏蔽复制卡的功能（即UID防火墙系统）；
1、由该芯片加工成的钥匙扣的block0（UID所在的block）可以任意修改，重复修改。
2、该卡支持手机直接读卡和写卡（该功能手机需有NFC功能，并且NFC的芯片需要兼容M1的才行，一般来说NXP的NFC芯片都可以，比如三星Note2，华为Mate2 Mat e8等），不需要特殊设备。
3、卡片的默认密码为12个F，即FFFFFFFFFFFF。

CUID卡
为了避开UID防火墙系统，CUID卡应运而生，取消响应后门指令(magic指令)，可修改UID，是目前市场上最常用的复制卡；
近两年，智能卡系统制造公司，根据CUID卡的特性研发出CUID卡防火墙，虽然现在（2019年）还不是很普及，但是总有一天CUID卡会和UID卡一样面临着淘汰；

FUID卡
FUID卡只能写一次UID，写完之后自动固化UID所在分区，就等同M1卡，目前任何防火墙系统都无法屏蔽，复制的卡几乎和原卡一模一样；
但缺点也相对明显，价格高、写坏卡率高，写错就废卡。

UFUID卡
集UID卡和FUID卡的优点于一身，使用后门指令，可修改UID，再手动锁卡，变成M1卡。
可先反复读写UID，确认数据无误，手动锁卡变成M1，解决了UID卡的UID防火墙屏蔽，也解决FUID的一次性写入容易写错的问题，且价格比FUID卡还便宜；

判断是M0卡(Mifare UltraLight)，还是M1卡(Mifare Classic 1k)，可以通过SAK值判断。

```
产品	ATQA	SAK	UID长度
Mifare Mini	00 04	09	4 bytes
Mifare Classic 1k	00 04	08	4 bytes
Mifare Classic 4k	00 02	18	4 bytes
Mifare Ultraligh	00 44	00	7 bytes
Mifare Plus	00 44	20	7 bytes
```

### 非加密IC卡和加密IC卡

非加密IC卡和加密IC卡的区别就是，非加密IC卡中所有扇区的KEYA和KEYB数值都是默认值FFFFFFFFFFFF；
而加密IC卡中，其中有扇区的KEYA和KEYB不等于FFFFFFFFFFFF，部分扇区加密的卡称半加密IC卡，所有扇区都加密的卡称全加密IC卡。

一般的读卡器，像手机的NFC，是读不到IC卡的加密数据的，需要用专门的工具，比如Proxmark3读取。

对于IC卡，除了对卡上数据加密，还有滚动码加密、服务器数据验证等技术。
因此，对IC卡的解密，更多的是门禁卡、签到卡、车库卡等的讨论，像公交卡、饭卡等涉及到资金问题的，基本都有服务器定期校验，得先搞定服务器再说，难度高还违法。

参考资料：
码农生活 篇二：IC卡门卡模拟探秘
IC卡简介【M1/S50，UID，CUID，FUID，UFUID复制卡介绍】
谈谈 Mifare Classic 破解
rfid-practice
Type A 卡存储结构与通信
Proxmark3 Easy破解门禁卡学习过程
